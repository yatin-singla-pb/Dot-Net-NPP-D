<main class="container">
  <nav aria-label="breadcrumb" id="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a [routerLink]="['/admin']">Administration</a></li>
      <li class="breadcrumb-item"><a [routerLink]="['/admin/contracts']">Contracts</a></li>
      <li class="breadcrumb-item"><a [routerLink]="['/admin/contracts/view', contractId]">View</a></li>
      <li class="breadcrumb-item active">New Version</li>
    </ol>
  </nav>

  <div class="d-flex align-items-center justify-content-between">
    <h3>Create New Contract Version</h3>
    <div>
      <button class="btn btn-secondary me-2" (click)="cancel()">Cancel</button>
      <button class="btn btn-denim" (click)="save()" [disabled]="submitting || form.invalid">
        <span *ngIf="submitting" class="spinner-border spinner-border-sm me-2"></span>
        Save Version
      </button>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger mt-2">{{error}}</div>

  <form [formGroup]="form" class="mt-3">
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Name <span class="text-danger">*</span></label>
        <input class="form-control" formControlName="name" maxlength="200" />
      </div>
      <div class="col-md-3">
        <label class="form-label">Start Date <span class="text-danger">*</span></label>
        <input type="date" class="form-control" formControlName="startDate" [class.has-value]="form.get('startDate')?.value" />
      </div>
      <div class="col-md-3">
        <label class="form-label">End Date <span class="text-danger">*</span></label>
        <input type="date" class="form-control" formControlName="endDate" [class.has-value]="form.get('endDate')?.value" />
      </div>
    </div>

    <div class="row g-3 mt-1">
      <div class="col-md-4">
        <label class="form-label">Foreign Contract ID</label>
        <input class="form-control" formControlName="foreignContractId" />
      </div>
      <div class="col-md-4 form-check mt-4">
        <input type="checkbox" class="form-check-input" id="sendPerf" formControlName="sendToPerformance" />
        <label class="form-check-label" for="sendPerf">Send To Performance</label>
      </div>
    </div>



    <div class="card mt-3">
      <div class="card-header"><strong>Manufacturer & Entegra Details</strong></div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Manufacturer Reference Number</label>
            <input class="form-control" formControlName="manufacturerReferenceNumber" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Manufacturer Billback Name</label>
            <input class="form-control" formControlName="manufacturerBillbackName" />
          </div>
        </div>
        <div class="row g-3 mt-1">
          <div class="col-md-6">
            <label class="form-label">Contact Person</label>
            <input class="form-control" formControlName="contactPerson" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Entegra Contract Type</label>
            <select class="form-select" formControlName="entegraContractType">
              <option [ngValue]="''">Select...</option>
              <option value="FOP">FOP</option>
              <option value="GAA">GAA</option>
              <option value="GPP">GPP</option>
              <option value="MKT">MKT</option>
              <option value="USG">USG</option>
              <option value="VDA">VDA</option>
            </select>
          </div>
        </div>
        <div class="row g-3 mt-1">
          <div class="col-md-6">
            <label class="form-label">Entegra VDA Program</label>
            <input class="form-control" formControlName="entegraVdaProgram" />
          </div>
        </div>
        <div class="mt-3">
          <label class="form-label">Manufacturer Terms and Conditions</label>
          <textarea class="form-control" rows="3" formControlName="manufacturerTermsAndConditions"></textarea>
        </div>
        <div class="mt-3">
          <label class="form-label">Manufacturer Notes</label>
          <textarea class="form-control" rows="2" formControlName="manufacturerNotes"></textarea>
        </div>
      </div>
    </div>

    <div class="mt-3">
      <label class="form-label">Internal Notes</label>
      <textarea class="form-control" rows="2" formControlName="internalNotes"></textarea>
    </div>

    <div class="card mt-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Prices</span>
        <button type="button" class="btn btn-sm btn-denim" (click)="addPrice()">Add Row</button>
      </div>
      <div class="table-responsive" style="max-height: 360px; overflow: auto;">
        <table class="table table-sm align-middle" style="min-width: 1400px;">
          <thead>
            <tr>
              <th style="width: 18rem;">Product <span class="text-danger">*</span></th>
              <th>Price</th>
              <th>Type</th>
              <th>UOM</th>
              <th>Tier</th>
              <th>Effective From</th>
              <th>Effective To</th>
              <th>PUA</th>
              <th>FFS Price</th>
              <th>NOI</th>
              <th>PTV</th>
              <th>Internal Notes</th>
              <th style="width: 4rem;"></th>
            </tr>
          </thead>
          <tbody formArrayName="prices">
            <tr *ngFor="let row of prices.controls; let i = index" [formGroupName]="i">
              <td>
                <select class="form-select" formControlName="productId">
                  <option [ngValue]="null">Select product</option>
                  <option *ngFor="let p of products" [ngValue]="p.id">{{p.name}}</option>
                </select>
              </td>
              <td><input type="number" class="form-control" formControlName="price" step="0.01" /></td>
              <td><input class="form-control" formControlName="priceType" maxlength="20" /></td>
              <td><input class="form-control" formControlName="uom" maxlength="20" /></td>
              <td><input class="form-control" formControlName="tier" maxlength="20" /></td>
              <td><input type="date" class="form-control" formControlName="effectiveFrom" [class.has-value]="row.get('effectiveFrom')?.value" /></td>
              <td><input type="date" class="form-control" formControlName="effectiveTo" [class.has-value]="row.get('effectiveTo')?.value" /></td>
              <td><input type="number" class="form-control" formControlName="pua" step="0.01" /></td>
              <td><input type="number" class="form-control" formControlName="ffsPrice" step="0.01" /></td>
              <td>
                <select class="form-select" formControlName="noiPrice">
                  <option [ngValue]="null">Select</option>
                  <option [ngValue]="true">Y</option>
                  <option [ngValue]="false">N</option>
                </select>
              </td>
              <td><input type="number" class="form-control" formControlName="ptv" step="0.01" /></td>
              <td><input type="text" class="form-control" formControlName="internalNotes" /></td>
              <td class="text-end"><button type="button" class="btn btn-sm btn-outline-danger" (click)="removePrice(i)"><i class="fa fa-trash"></i></button></td>
            </tr>
            <tr *ngIf="prices.length === 0">
              <td colspan="13" class="text-center text-muted">No price rows. Click Add Row to begin.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </form>
</main>

